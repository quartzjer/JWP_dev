
const { fromKeyLike } = require('jose/jwk/from_key_like');
const { generateKeyPair } = require('jose/util/generate_key_pair');
const { calculateThumbprint } = require('jose/jwk/thumbprint');


(async function(){
    const { publicKey, privateKey } = await generateKeyPair('ES256');
    const jwk = await fromKeyLike(publicKey);
    jwk.kid = await calculateThumbprint(jwk);
    jwk.alg = 'SU-' + jwk.alg;
    jwk.use = 'proof';
    jwk.payloads = [
        {"claims":["family_name", "given_name"]},
        {"claims":["email"]},
        {"claims":["birthdate"]},
        {"claims":["age"], "cty":"hashchain-commitment"},
        {"claims":["profile_pic"], "cty":"image/png"}]
    console.log(JSON.stringify(jwk));

    const jwp = {protected:{}, payloads:[]};
    jwp.protected.kid = jwk.kid;
    jwp.issuer = 'https://issuer.tld';
    jwp.typ = 'JWP';
    jwp.payloads.push({'family_name':'Miller','given_name':'Jer'});
    jwp.payloads.push({'email':'jer@jeremie.com'});
    jwp.payloads.push({'birthdate':'2042'});
    jwp.payloads.push(Buffer.from('e320b6c2fffc8d750423db8b1eb942ae710e951ed797f7affc8892b0f1fc122b','hex'));
    jwp.payloads.push(Buffer.from('89504e470d0a1a0a0000000d494844520000003c0000003c08060000003afcd9720000128f49444154789cec7a698c5bd775ffefbdfbf6f7c8c77d66c81979362db616478e21cbb16464b11367f9c771fc6f9cd6491ab440daa24d837c28e2a69f02b41fd2a2458b3441daa0419ba54decb4486a07b52bd9f192c8b1bcc9923cb234d22cd26c1c72b80c9747beb5b8978b66641bb6c8710cb43902f13824f5def9dd73ceef2cf7f2f83f26bf06fcbf5d7e0df8572537efda4ede8ee70abf8a878c0d0ca8771c3e78c3ed076ffcc0beede3fb53f1e824cf71861f0456ae503ef3c091c77ef0d3471e7be8a973172a6fb52edc5b79f3033b7726eefbcd4ffcc9a19bf67f5a09a943080204f48b2000781e20041c7deffb5491d5175f99fee65f7efd1ffff6f1e9d3c56af5add1e92d019cd17572df677ffb8b1fbce9c09f468622315196ba4fe31515440f819364705cebf181ef23701cf84d0b8155cf9f3b7be21fbef477dffdaba3274e95b75ab72d077cf7e1c3e6e73ffaffbe9719487d448fe9e079be058c0364d384924ab5815ef1e8b6f583208057abc0af94e6fef9df1ffcfc97bef14f0f594d7bcbf4db52e2b8fb4387c35ffef83d4762e1f07b7453074f5a9cc8a0711ca448144456ba96dd241c77f9739e8757ab46f65fb7eb137b2747b30f1c7de2f9add271cb00a72311eeab9ff9ddfb6361f3bda22a425224706859966b5b999725089af6da80dbd6a5eeed16f380e7d1dff193db866fd709f7e2f1a9a969dbf5fbd6734b001b8681affec167beb07b64e20b14a01ed61928f6af6d398ee7589cf292045e143781a640d9d575e11456d9ef3adffb5e20ec9bd87e473e5ffcafe7a72facf6abeb9600beede041e3f76effe0fd0160489a044116c0d314df0e55665d8e5a19f0ac1a02cf05274accf26893965fafc129752ddbfa3c08e0bb3e3cd7d30e5cb76bf2e8895f7c3757a8f5a56bdf79d8d4757ce5a377dde707c120555094c5ae2b03b8ac3c82ee7baf5a8157af811705f03c610b80b695af7477df6bb97128641cba25b33d3935bd9aeb47dfbe2bad5b0706474555fc22bb19e141686e6d2bdd55be6de5cb57aeb51eae87c0755a8eb091b43af14c19dbf53a7fcb9363a3efec57dfbe00cb00760e8f7ceef833cf6aaeebb658b9a3f3060bb7e1b1eb464bbf5152f41c0fed528502e6af4d0f8df5a32ffa053c2ccbca482af5e946a389c25a61938536baf5ab2cdcfeac4356570a8b5dcad6367575160feca2c492a97ef445bf806fdbb3ef4e8ee7d3e85892df60b28d20af88e9aec583d737b1db745b0b12b4e29f21169853f5253d038e0a12e490f1e1ce3d36c5e026dcaf26b08e04dcab2d4c41ba8e0bcf6bb973172c009d276f1f605d0d2142c4780702232bfe72cea5f1cc0bed17e13759bf0362a34b336894a41cafebca1b3d802e5cddf3a3a3b144af2a33e9392dd9cd0ac29a1665c9350840048181221281a44a5db77d3da1e03abfe900a78c4caddbb16867613a5e1200aaa1f667e49e014bb2c8c9aab2a3a370271db12b36a7980e804dae7e450aea9054e007ddd8bd520204a24ffaab957a063c180e5d0320d2d61884b4ebe576c370250353209b48ad2d9d4f6857454402a7e16c72f78d5ec08285b0957a6d7a7f13d2730cdf79d38d631461c718ac0da4712b4bac6ca41d0ffd9c5a0e6d77ed8020e10884481c9ca4b022a4231430abb9b1012cd78e6f3f8055b178bfcffea127ff78cfde3df1fd076e7cfadcf959451745c8ba8aa5460953f3b3b8b49a032f2a88a43320be07ab5c852889b0aa168840108802d61d0f17e6e6f1f2f4349e3f791256a38181449cd5db6c61bca05ba450a1ae5e295621f85e767462dbf9a6db28ce2cacf4d424f7340088c5625ffbc4c73ef64787aebf1ea55209812020083c94b3abc86597200a0106a226ae1fdf81ede911c48663a8e42a28ae95f1e8a9e368d836c29a810133064d56a00812cc4808631323f06c178ee38166ac6aa38167cecde0f1d36720100e7ffc1b1f414251fc86ef1ebdebf35ffec0f3e7cf5fb5ee3dc5b06ddbe1dfb9eb63d0ed261ac9181443c35c3e8f45f8488f8d62b55446b958c00f1e791c9fbce3fd88342dcc2eae80844c18c3dba1b91e7849c69aebc00f9b301271543c0fbf98c9627a691123711dc74f9d87ce71a8da0e7efff021a447522c659d3afe329f1e1bdc6f68a4a758ee09703299fc8b442276afeedba45aaa820822263323d0041e75cbc2aee13da8e4f2f8d6f9192c578a985a5e44c10970efeebd68da4de40b0584c7c7f1e8c30fa2b25e40e0bb20951aa2a11038d7c7dc6a0e1141c27822863d9934449e607db50c2daa23128da052abcf54eb5e4fc4d513e0502c764155d475d2f4a29164041c080449c0d0601ccd4613a55c09654dc5b861e0aef7de028e103cf5c25954020f09338c46dd424612f1a93bef62f75355058d6a03bee761bab28e83f134941181f5d5b4bfae156baced0cc542582f96e1aae2230be5dee67b3db1345958f050b748aba22290751944e0bb2c9c184ae0dccc2cde39310a4e10408c3032868ab2ed203e94407228854ab5c208da08e91044022dac413154bcfb867dd01599b18ba888f06c8f79c533c78ea3982d22128f7ab9534fff389bebad2deec9c2939961c9595910f98124444d8047399510102240956558968d917a1d832383ad71acac22153331344c33598081e181d68dda551a4d5dbeef41898691702d201d6516a7a2c54cc86103cbc5229e3df61cdef5be9b4ffff5c3a75eec096daf805f585cb039f8b65bc8a982ad21a0e986e310f084e5df99a75f44ad58c2f02d37802302786a6559825bc8c34dc4405af522e0f908029f5625e078c02be6e0ac5768fdc8ac6b5b36244383e754c08343246662fae2a5079f7ef1955ef1f60638120410442eebfabed96a0cf8165ffa1e72f30b585bce22958cc1081b6c5e45857ac0f9174e606c62147a446731bf513af99186477dbddefe8c835bafa194cdc30c87303430e67eef178ffea88cdee7f33dc53085905bccadd322816f83f5031febf9755c78f90276ecdf8350380c2209c84d5f845b29b351cef8b5e3387bfa1c72f33954d62aad419e285d06dda9c5798ecdb24455645b31f17402a33b27617bf6930f3cf0f04b3da3ed15b0a712042ed2d5b5d6de17ad8828935a150bbee360eac4148b4ffad9f2f91964cfcc60e1c22216671658d5e5c2c3d993675158c8b1129357f54df7a725a66228507419d54215f98bab9043ba7ff4b1637f7f6271b11fbcbdb9b4d36444a3f11b1a04cdd4b03433078132b71fa0e97a987afe34b37c2e9b63cc4d441e66d4645e51afd7307dfa2c4455417830bee9fe3405f1ed112e7d9f184e607566f6d8f78f1c79a82fb43de7614d279eeb481ce1ba4c9b9d5b426925cf82311c8b213db10daaa931f7a5f9d34c99ecff52b7a5e96bc7be1d38f7d234a65f3a83ebf57dacdbc206b746bb435a5dc921ace9735ffde6b73ff9f3d959a75fc03db9b44944be56a9a25eab839335e6ca8b17e6e1f93e244541249980208b083c1f8220c0693a5d30d8300e1a1ecb80c80495d2eb6f0bd7ac06fef3c9273e77ff0b2ff4e7cb6de9c9c2c72fce3a27a7ce5ab2a268d7dd76186a2c0249d7f1f0b15fa2eabab8fb3def8357b76024a38c9159aeb53dc6c494f00aa5320af9226aa50a22d1309b720484c0b79d9675db13cd86d5a06c8826e755ab5bb461dc1360ca9ca57afd957010dcb2b6b08c81b16168aa8cc37bf760f9d20ab284c7de3b3e0494cb50340d9c282250141472ab289c9d46239f43341cc26a6e0ea97802e1540a9c6aa0b6ba80703cdc7dcefccc2544a2a69f8e19835b82b6d77eb8e179d81d8da6e366e4bd22cf233d9c4469790d8e6521140941b31a583bf932c2a1309c6a1576a1007b69115abd824444c6403a0e5557e1353dc8aa8ad8e4282a4bab100858fd4ca556a9e1dc99198c8e8d7089f448f9e15f3ef350a1b4de37e09e271e8fbc72e61b3cc72dcf4ecfc02a556044221024090221ac4a0a250c34caab083c0b9e5387eb37210f46c1493c233acabef1c114644d66bce75a75c886c2dc9b161e2f3d7b125133022da42213370f0dc5a37d83453fbb878566d34a716421699a1f970499a35595a2ea4c61a7d9641d114f4b4d2f806b35981539cf46255784dc9e3cb2d4c301c47758f3d1ac37e1580e561657b0bc9cc3c8b60ca20993fe50aa9c5ef9f691b3a7fadb3aec77bb74612d3fb567dbb6ebdc7a6377269d6684a38542d0c326644d85aca8903505d1740c701ce4679658e9282912abce2840b4d38f5db7d9b55828e2f44ba7911c18446a28012da4d145546ebaf5861ba7cecffdf0ecfc45f76d036c0501e6b2d59fed1b4a7e5891e5146dcea908928850dc84998c209c0ca3596ba05a5847281e626d2015c7765a3573d01ad0d17f8b171771eac429c89a86643281e1f1344b5fcd5a13a2228c5d3796d69f3a7ef2917ca5f7d34d7d6f88979b552b5cab1c8986ccdfca0c67346665536385066d10d8cc5a2030a2068b5bb42799957c8501a1f5b6e77b38736a0a3317e65823924aa791c9a46098061bead15651d1152463b1033b87424ffeebd163736f1b602a17d6d70b92204e2715f5e3a98114a1c0682d4c85e77806189d133aaec71a8746a5c180af15d6980b5357a660a3a901c463518c8c67e0baad0d35ba30b465e4003e333c7aab50bdf8e0f373f992e35c7de1b525803d001757965f1914255f22c2bba391284709a93b94f75b1b64d452d4b2b432cbae66313d3d8d95e515b608b42809476330232626778eb2382fad954038c2e29dc63e1bf4f35cf4f0cdb7de333e3e72f289e79ebbd468385735a9deb2533c368093cb4bc754d19f70d6ad7d22d71acf58550b95620585d50216e797b070e91266e766512c16d90e61a7dcd4cd082b49775e378650d8406e2907331e4175ad0a35acb2f0d870f6c398181cbc77f778e6ff978ab57cb9d47c6524631ed8bf6be4b3cd6673b652b75f37616fd9c1b4a1a831beeb9ae457f490766f4c30b811390e4d5590888421b65d7ad38679bb89a012a2968dc7b07bdf76e8ba8a42b6c0ba2cddd0515c2e626872e8358f4480d5da16bef51f3f9c9fbe7469841081775cefe4e3cf4ebd6f2957cabf2580531135be6732fd67baa27c0e1ca783ed18f8985006101254f61b0ad83474847475532744251c8bc3304d0c44a318184ec2a76c3db7801d7b7760eecc3c128371c6ee5782753d17cf4dbd8cc79e7d06d9c21afb9e6dc8b12d1d7fe1b9d3b3f79cbbb47aec4a7d7baaa569bd303e187fe7c448ea536658bbdb6a3447b0d182018735bf8a841062165368d3ef79f03c9f4d39c1464422cc7802baae23619a9025092bf3594662d71fdc8beca52c049e6cde436e1f74393b3f879f3cf1189672ad635b34347c3f60858c2832d71fbe71efe4d7cbe5f5dbb2eb8db58dba5fb585c3b2a81fdc3bf1e7d1a8f187e038913eacd16c761bf68ee8ba86ddea1012aa81cc4002b6e7c1692b465928961a4032958226b7c8a85c2ec3aa5b18181c806ddb28e5f318c864d8bd8cb8c1d25ab55ec7771efa097e79f225a88a0259961958c226a63cb3b0c706832df07eb3f9b31f3df1c2ed4ddbf73a7a5d15690d474363efbe79d7514d53efe409cffa38a79d3a361e26a38ad095a6ad5d98575867a42b0aec4613115d83a1aa20be8f682cce2c9ecfe551cee731327a0d63e4b9f3e7c1fb2e8c48b455785836ce2fcde36fbeff2f989e9f6f59d5f7210a022449e8ee4db3ccd07eb1d12f82b189e1c43517970b471cd773ae0a703aaa8e1d3a70ed938aac6e97658935f61454a3d1e89e82ed1091a16bcc6d6b4e1369b9557d51025bc8e6d16c3a081bad1eb951afb3055bcfafb2d1906b3b58585c808080b91e757bcb7771ffcf8fe2df1efd6ff62c0a863e3b64e810d911c6cb1b00b471a10b4039431245f62284bc63473a79782e5bf8b1edb88d370df8d04d935f8b18e6a1ce71e00e49d4ea16732ffa9e3e982aa36b2a1cb7e5c27220400281d568c2765cf68a8543cc053dd7856d592cb2d66b755c5c5c86a9a9cc728eefe1e90b67f09da78e60666599595e140914a9e53d84085d02e4790e614385a648904481bd286881f0ad3d6642aeb9763cf57e490a2ebd29d2da3f14bb39a647efd9981a5805d4b441da0b40af349e5455e96e84d34ae9546d113cc7211584d9957e49ad4ad38ed5b0d908a752b7d86f135113eb8e85330b4b38b138874aa3b5fb40780e9248989750ef6934eccb0752a947690a3c9fead380cb7631da6743f8965e742108afec7fd73bf6fef40d01ab2a3039b1ed3e4278f1ca6347b6e3b458b77d9c90ae38655b9a1a5a04e2c1093c1c5bbe00435490d123882a2a2af30db6ffeb053e9a818baa63a36c5b28ad4ea354bbdc01722ca5f1505519215d87205cb66810f8dd83310ddb415857208b427711bc368179ed3323aee783706f222dc9820a4e25fb5f75c62a005cc781a228ed8ec7078d6dfa3b6a2d9a86d056d8717dd4dc26ce95b340b9b549f146e941201c44c233b6a756dde8591470e72805bd91e37828572ce89ad272639a9ee84bb89cefa9d56988bd2160cd6a721c2b28368b4f997e838bd315359875a9bb06ddb291262b5924683a5e6bf3847b6db0417bfc42bfa796d45519baa6750fcb6c948d555ae76f6ac9f56a7d0361914dd51921ac0ec7ff040000ffff18c35ab10d34b30b0000000049454e44ae426082','hex'));
    
})();
